{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">

    <h3>Buscar nodo y ver ruta</h3>

    <form method="get" class="mt-3">
        <input type="text" name="nodo"
               class="form-control"
               placeholder="Ingrese el número del nodo"
               value="{{ request.GET.nodo }}">
        <button class="btn btn-primary mt-2">Buscar</button>
    </form>

    {% if nodo %}
    <hr>
    <h4>Nodo encontrado: {{ nodo.nodo }}</h4>

    {% load l10n %}
    {% localize off %}
    <p>
        <b>Latitud:</b> {{ nodo.latitud }} <br>
        <b>Longitud:</b> {{ nodo.longitud }}
    </p>

    <button id="btnRuta" class="btn btn-success mt-3">Ver Ruta</button>
    {% endlocalize %}

    <script>
        document.getElementById("btnRuta").addEventListener("click", () => {

            if (!navigator.geolocation) {
                alert("La geolocalización no es soportada por este navegador.");
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const latUser = pos.coords.latitude;
                    const lonUser = pos.coords.longitude;

                    // Coordenadas del nodo como números reales
                    const latNodo = Number("{{ nodo.latitud }}");
                    const lonNodo = Number("{{ nodo.longitud }}");

                    // Crear URL de Google Maps en modo ruta
                    const url = `https://www.google.com/maps/dir/${latUser},${lonUser}/${latNodo},${lonNodo}`;

                    window.open(url, "_blank");
                },
                () => {
                    alert("No se pudo obtener tu ubicación. Activa el GPS y da permisos.");
                }
            );
        });
    </script>

    {% endif %}

</div>
{% endblock %}
